<!doctype html><html style="has-navbar-fixed-top has-navbar-fixed-bottom" lang=ja><head><meta charset=utf-8><meta viewport="width=device-width, initial-scale=1"><link href="/favicon.ico?refresh=1" rel=icon type=image/x-icon><link href=https://shnarazk.github.io/atom.xml rel=alternate title=RSS type=application/atom+xml><link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css rel=stylesheet><link href=/style.css rel=stylesheet><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X rel=stylesheet><script crossorigin defer integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-LJ2FmexL77rmGm6SIpxq7y+XA6bkLzGZEgCywzKOZG/ws4va9fUVu2neMjvc3zdv src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/mathtex-script-type.min.js></script><script onload="renderMathInElement(document.body, {
				delimiters: [
					{left: '$$', right: '$$', display: true},
					{left: '$', right: '$', display: false},
					{left: '\\(', right: '\\)', display: false},
					{left: '\\[', right: '\\]', display: true}
				]
			});" crossorigin defer integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener('DOMContentLoaded',()=>{const a=Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'),0);if(a.length>0){a.forEach(b=>{b.addEventListener('click',()=>{const c=b.dataset.target;const d=document.getElementById(c);b.classList.toggle('is-active');d.classList.toggle('is-active')})})}})</script><title>Just a note</title><body><nav aria-label="main navigation" class="navbar is-fixed-top is-light" role=navigation><div class=navbar-brand><div class=navbar-item> <i class="fas fa-book-open has-text-info"></i> <a class=title href=/>Helix text editor!</a></div><a aria-expanded=false aria-label=menu class=navbar-burger data-target=navigation-bar role=button> <span aria-hidden=true></span> <span aria-hidden=true></span> <span aria-hidden=true></span> </a></div><div class=navbar-menu id=navigation-bar><div class=navbar-end><div class="navbar-item has-dropdown" id=navigation-dropdown><a onclick="document.getElementById('navigation-dropdown').classList.toggle('is-active')" class=navbar-link></a><div class="navbar-dropdown is-right is-size-5"><a class=navbar-item href=/tags> <i class="fas fa-tags"></i> Tags </a><a class=navbar-item href=/about> <i class="fas fa-question-circle"></i> About </a><a class=navbar-item href=/atom.xml> <i class="fas fa-rss-square"></i>  RSS </a></div></div></div></div></nav><div style=padding-top:3rem><div class=article-container><h1 class="subtitle has-text-info has-text-weight-semibold">さようならVS code, Zed</h1><p>ふとしたことで純Rust製の高速エディタが開発中 by <a href=https://zed.dev>zed.dev</a>というのを見て早速登録してみたもののなんの音沙汰もなし（知った時点でHacker newsで紹介されてから既に数ヶ月）。 同じようなタイミングでReddit経由で<a href=https://docs.helix-editor.com/>helix</a>というエディタを知った。 コンソール内で動くS+V形式のvi系エディタということだが（名前だけは知っていた）基になった<a href=https://kakoune.org>Kakoune</a>ともども色々設計方針を読み、 なんか面白そうなので使っていみたら大変気に入ってしまった。<p>いいところ：<ul><li>multi selectionが基本機能。 実はまだKakouneの<a href=https://kakoune.org/why-kakoune/video/regroup.webm>デモ</a>にある機能が再現できないのだけど、selectionから複数のselectionを作り、それから必要なものだけを選択し、編集したり、必要なものだけを削除して別の場所にまとめて貼り付けたりできる。 これはつまり関数型プログラミングパラダイムの<code>iter</code>, <code>map</code>, <code>filter</code>, <code>collect</code>そのものじゃないか。 これはテキストエディターに来るとは思っていなかった、乗り換える価値のある「新しさ」ではなかろうか。<li>LTSが基本機能。Rustに関しては本体とRust-analyzer以外不要。保存するだけでclippyのメッセージが埋め込まれる。<li>構文解析器<a href=https://github.com/tree-sitter/tree-sitter>tree-sitter</a>が標準組み込みなので、引数単位、式単位、文単位などでの移動ができる。 Surround系機能が時代遅れに感じる。 SchemeやCommon Lispを対象にGnu Emacsが提供していたsexp系の機能が今の時代に復活してきたような感慨深いものがある。<li>レジスタ指定貼り付け時など、所々でKakouneと同様に情報ボックスが表示される。これは親切。<li>挿入モードに入った後の編集機能のキーバインディングがEmacs。なので挿入モードに入った後はEmacsみたいな感じで編集できる。 つまりほとんどの時間は入力モードで時々移動と選択が便利。 これはEmacsを挿入に特化したエディタというvi派の主張に乗っかっていうなら、Helixは移動編集用モードが追加されたEmacsとも言える。 これまでお気に入りだったEmacs w/ evil modeからさらにpost modernな感じで融合したしたような印象。ほぼ乗り換えてしまった。<li>"anchor"という言葉がマニュアルにできてきた。これはEmacsで言うところのマーカーではないか。 vi系エディタでのカーソルの基本コンセプトがどうしても身に付かないところがあったのだが、 cursorとmarkerの2種類の(文字と文字との間に位置する)場所指定子から構成されるリージョン(helixでいうところのsection)があって、 それが<code>;</code>でキャンセル(shrink)、<code>Alt-;</code>で場所指定子の入れ替えができるとなるともはやEmacsと変わるところがない。 また挿入が単なるリージョンの置き換えに加え、リージョンの直前、直後への挿入が用意されていると考えれば拡張された機能として納得いくものがある。 (そう考えるとnormal modeのカーソルはblockではなく、広がりをイメージさせるunderlineにしたいところなのだが、どうもしっくりこないので固執するのはやめた。)</ul><p>というわけで、gnus, magit, diredなどEmacsが得意な非ファイル系の操作以外の、つまり基本編集に関してはとうとうhelixの方が便利かもというところまで来てしまいました。<h1 id=色々>色々</h1><h4 id=構文を認識していない>構文を認識していない</h4><p>最近grammarの取り込みが選択的になったせいか、このようなことが起きるようになった。 README.mdには以下のように書いてある。<pre style=background:#fff;color:#323232><code><span>cargo install --path helix-term
</span><span>hx --grammar fetch
</span><span>hx --grammar build
</span></code></pre><p>しかし少なくともmacOSでは、<pre style=background:#fff;color:#323232><code><span>rm -fr runtime/grammar
</span></code></pre><p>がインストールの前に必要だった。 これはどうもデフォルトのHELIX_RUNTIMEがCARGO_HOMEから構成されていたみたい。 ~/.config/helix/runtime を作るところから始めれば問題ないかも。ということでissueを立てるような話ではなかった。<h4 id=なぜかCtrl-{h,l,j,k}が空いている>なぜかCtrl-{h,l,j,k}が空いている</h4><p>もったいない。tree-sitterを使った構文単位の移動が<code>Alt-{h,l,j,k}</code>に割り当てられているのだけど、 <code>Alt</code>はmacOSだと押しにくい<code>Option</code>に割り当てないといけない。 なぜか<code>Ctrl</code>をprefixにしたキーシークエンスが開いていることに気づいたので、そちらに割り当て直したら<strong>非常に</strong>便利になった。Rustで式単位、文単位での削除移動がセクションの始まりと終わりを気にせずできるようになった。<p>ということで現在、~/.config/helix/config.tomlでのnormal modeの設定はこんな感じ<pre style=background:#fff;color:#323232><code><span>[keys.normal]
</span><span>"C-h" = "select_prev_sibling"
</span><span>"C-l" = "select_next_sibling"
</span><span>"C-j" = "shrink_selection"
</span><span>"C-k" = "expand_selection"
</span><span>"D" = "delete_char_backward"
</span><span>"H" = "move_prev_word_end"
</span><span>"^" = "goto_line_start"
</span><span>"$" = "goto_line_end"
</span></code></pre><ul><li><code>move_prev_word_end</code>はせっかく定義されているのにバインドされていないので、対称性を担保するためにも修飾された<code>h</code>に割り当てた。<li><code>D</code>は本当は<code>C-h</code>であるべきではあると思うのだが（実際全然慣れないのだが）構文木移動系に取られてしまったので仕方なく。<li><code>^|$</code>は設定するより<code>gh|gl</code>に慣れるべきなんだろうが、そこまで自分を追い込まなくてもいいだろう。正規表現の長い歴史に敬意を払って、または怠惰な自分のために残した。</ul><h4 id=Solarized系テーマでは対応する括弧とカーソルとの見分けがつかない>Solarized系テーマでは対応する括弧とカーソルとの見分けがつかない</h4><ul><li>(2022-03-25) ちょっと修正したバージョンが取り込まれました。</ul><p>対応する括弧のための表示修飾とカーソルのそのもののそれが同じというのはすごく嫌。 カーソルの位置とその表現がvi系と違っているため括弧とカーソルがずれているEmacsや、 対応する括弧は同じ表示修飾を使っているけどもカーソルの表現がその上に乗っているVScodeではこうならない。しょうがないのでパッチを当てた（正確には別名を割り当てた）。<pre class=language-diff data-lang=diff style=background:#fff;color:#323232><code class=language-diff data-lang=diff><span>diff --git a/runtime/themes/solarized_dark.toml b/runtime/themes/solarized_dark.toml
</span><span>index e3d587d4..dd2013e2 100644
</span><span style=background:#ffecec;font-weight:700;font-style:italic;color:#bd2c00>---</span><span style=font-style:italic;color:#969896> a/runtime/themes/solarized_dark.toml
</span><span style=background:#eaffea;font-weight:700;font-style:italic;color:#55a532>+++</span><span style=font-style:italic;color:#969896> b/runtime/themes/solarized_dark.toml
</span><span style=font-weight:700;font-style:italic;color:#969896>@@ -81,7 +81,7 @@
</span><span> "ui.cursor" = {fg = "base02", bg = "cyan"}
</span><span> "ui.cursor.insert" = {fg = "base03", bg = "base3"}
</span><span> # 当前光标匹配的标点符号
</span><span style=background:#ffecec;color:#323232>-"ui.cursor.match" = {modifiers = ["reversed"]}
</span><span style=background:#eaffea;font-weight:700;color:#55a532>+</span><span style=background:#eaffea;color:#323232>"ui.cursor.match" = { fg = "base03", bg = "base00" }
</span><span> 
</span><span> "warning" =  { fg = "orange", modifiers= ["bold", "underlined"] }
</span><span> "error" = { fg = "red", modifiers= ["bold", "underlined"] }
</span><span>diff --git a/runtime/themes/solarized_light.toml b/runtime/themes/solarized_light.toml
</span><span>index 3191add3..9c820294 100644
</span><span style=background:#ffecec;font-weight:700;font-style:italic;color:#bd2c00>---</span><span style=font-style:italic;color:#969896> a/runtime/themes/solarized_light.toml
</span><span style=background:#eaffea;font-weight:700;font-style:italic;color:#55a532>+++</span><span style=font-style:italic;color:#969896> b/runtime/themes/solarized_light.toml
</span><span style=font-weight:700;font-style:italic;color:#969896>@@ -81,7 +81,7 @@
</span><span> "ui.cursor" = {fg = "base02", bg = "cyan"}
</span><span> "ui.cursor.insert" = {fg = "base03", bg = "base3"}
</span><span> # 当前光标匹配的标点符号
</span><span style=background:#ffecec;color:#323232>-"ui.cursor.match" = {modifiers = ["reversed"]}
</span><span style=background:#eaffea;font-weight:700;color:#55a532>+</span><span style=background:#eaffea;color:#323232>"ui.cursor.match" = { fg = "base02", bg = "light-gray" }
</span><span> 
</span><span> "warning" =  { fg = "orange", modifiers= ["bold", "underlined"] }
</span><span> "error" = { fg = "red", modifiers= ["bold", "underlined"] }
</span></code></pre><h4 id=ここだけの話>ここだけの話</h4><p>vi系は移動が便利だとは思わない。選択が便利なのでは。<div class="date-footer is-size-7 is-family-code has-text-grey has-text-right" style=margin-top:2rem>Published at 2022-03-15   Last updated 2021-03-21 </div></div><nav class="navbar is-fixed-bottom" aria-label=navigation id=bottombar><div class=navbar-brand><div class=navbar-item><a class=tagword href=/tags/#helix>#helix</a></div></div></nav><footer class="copyright is-size-6 has-text-info">Copyright 2019-2023 Narazaki Shuji.</footer>