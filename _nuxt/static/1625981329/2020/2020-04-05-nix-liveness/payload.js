__NUXT_JSONP__("/2020/2020-04-05-nix-liveness", {data:[{article:Object.create(null,{default:{writable:true,enumerable:true,value:{title:"Liveness of nix-store created by 'nix-build'",subtitle:"No 'nix-store --delete --ignore-liveness'",date:"2020-04-05T00:00:00.000Z",tags:["NixOS"],bodyContent:"昨日、[nixOS](https:\u002F\u002Fnixos.org) に [cadical](https:\u002F\u002Fgithub.com\u002Farminbiere\u002Fcadical) が追加されたけど、それに至るまでは[nixpkgsリポジトリ](https:\u002F\u002Fgithub.com\u002FNixOS\u002Fnixpkgs)のクローンを作って、自分でnix-buildを繰り返していた。\n一旦 `nix-build -A cadical` でパッケージを作成するとnix expressionを変更してもartifactのstoreが更新されないことが多い。\n調べて nix-storeのdeleteオプションで消せることがわかったけど、実行すると死んでないから削除できないというエラーが出る。`nix-env -e cadical` で削除しても同じエラーになる。\n\ndeleteオプションには`--ignore-liveness`という強力なフラグがあるのだけどこれを使っていたらnixの環境がgcされてnixでインストールしたものが一瞬全てなくなる羽目になってしまった。\nこれは結局 `\u002Fnix-profile\u002Fbin から辿れるシンボリックリンクを貼り直すことで回復できたけど、もうこのオプションは使いたくない。一体なぜパッケージを自分の環境から削除したのゴミにならないのか？\n\n調べてみたら（いや、適当に見当つけて見たら）、nixpkgsワーキングツリーのトップにnix-buildで生成されたstoreへのシンボリックリンク result というのが自動的にできるのだけど、これがGCのrootになっていた。\n\nということで result をrmで消すと（そして nix-env -e すると）、 nix-store --delete で素直に消えてくれるようになりました。",bodyHtml:"\u003Cp\u003E昨日、\u003Ca href=\"https:\u002F\u002Fnixos.org\"\u003EnixOS\u003C\u002Fa\u003E に \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farminbiere\u002Fcadical\"\u003Ecadical\u003C\u002Fa\u003E が追加されたけど、それに至るまでは\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNixOS\u002Fnixpkgs\"\u003Enixpkgsリポジトリ\u003C\u002Fa\u003Eのクローンを作って、自分でnix-buildを繰り返していた。\n一旦 \u003Ccode\u003Enix-build -A cadical\u003C\u002Fcode\u003E でパッケージを作成するとnix expressionを変更してもartifactのstoreが更新されないことが多い。\n調べて nix-storeのdeleteオプションで消せることがわかったけど、実行すると死んでないから削除できないというエラーが出る。\u003Ccode\u003Enix-env -e cadical\u003C\u002Fcode\u003E で削除しても同じエラーになる。\u003C\u002Fp\u003E\n\u003Cp\u003Edeleteオプションには\u003Ccode\u003E--ignore-liveness\u003C\u002Fcode\u003Eという強力なフラグがあるのだけどこれを使っていたらnixの環境がgcされてnixでインストールしたものが一瞬全てなくなる羽目になってしまった。\nこれは結局 `\u002Fnix-profile\u002Fbin から辿れるシンボリックリンクを貼り直すことで回復できたけど、もうこのオプションは使いたくない。一体なぜパッケージを自分の環境から削除したのゴミにならないのか？\u003C\u002Fp\u003E\n\u003Cp\u003E調べてみたら（いや、適当に見当つけて見たら）、nixpkgsワーキングツリーのトップにnix-buildで生成されたstoreへのシンボリックリンク result というのが自動的にできるのだけど、これがGCのrootになっていた。\u003C\u002Fp\u003E\n\u003Cp\u003Eということで result をrmで消すと（そして nix-env -e すると）、 nix-store --delete で素直に消えてくれるようになりました。\u003C\u002Fp\u003E\n",dir:"article\u002F.json\u002F2020",base:"2020-04-05-nix-liveness.json",ext:".json",sourceBase:"2020-04-05-nix-liveness.md",sourceExt:".md"}},title:{writable:true,enumerable:true,value:"Liveness of nix-store created by 'nix-build'"},subtitle:{writable:true,enumerable:true,value:"No 'nix-store --delete --ignore-liveness'"},date:{writable:true,enumerable:true,value:"2020-04-05T00:00:00.000Z"},tags:{writable:true,enumerable:true,value:["NixOS"]},bodyContent:{writable:true,enumerable:true,value:"昨日、[nixOS](https:\u002F\u002Fnixos.org) に [cadical](https:\u002F\u002Fgithub.com\u002Farminbiere\u002Fcadical) が追加されたけど、それに至るまでは[nixpkgsリポジトリ](https:\u002F\u002Fgithub.com\u002FNixOS\u002Fnixpkgs)のクローンを作って、自分でnix-buildを繰り返していた。\n一旦 `nix-build -A cadical` でパッケージを作成するとnix expressionを変更してもartifactのstoreが更新されないことが多い。\n調べて nix-storeのdeleteオプションで消せることがわかったけど、実行すると死んでないから削除できないというエラーが出る。`nix-env -e cadical` で削除しても同じエラーになる。\n\ndeleteオプションには`--ignore-liveness`という強力なフラグがあるのだけどこれを使っていたらnixの環境がgcされてnixでインストールしたものが一瞬全てなくなる羽目になってしまった。\nこれは結局 `\u002Fnix-profile\u002Fbin から辿れるシンボリックリンクを貼り直すことで回復できたけど、もうこのオプションは使いたくない。一体なぜパッケージを自分の環境から削除したのゴミにならないのか？\n\n調べてみたら（いや、適当に見当つけて見たら）、nixpkgsワーキングツリーのトップにnix-buildで生成されたstoreへのシンボリックリンク result というのが自動的にできるのだけど、これがGCのrootになっていた。\n\nということで result をrmで消すと（そして nix-env -e すると）、 nix-store --delete で素直に消えてくれるようになりました。"},bodyHtml:{writable:true,enumerable:true,value:"\u003Cp\u003E昨日、\u003Ca href=\"https:\u002F\u002Fnixos.org\"\u003EnixOS\u003C\u002Fa\u003E に \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farminbiere\u002Fcadical\"\u003Ecadical\u003C\u002Fa\u003E が追加されたけど、それに至るまでは\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNixOS\u002Fnixpkgs\"\u003Enixpkgsリポジトリ\u003C\u002Fa\u003Eのクローンを作って、自分でnix-buildを繰り返していた。\n一旦 \u003Ccode\u003Enix-build -A cadical\u003C\u002Fcode\u003E でパッケージを作成するとnix expressionを変更してもartifactのstoreが更新されないことが多い。\n調べて nix-storeのdeleteオプションで消せることがわかったけど、実行すると死んでないから削除できないというエラーが出る。\u003Ccode\u003Enix-env -e cadical\u003C\u002Fcode\u003E で削除しても同じエラーになる。\u003C\u002Fp\u003E\n\u003Cp\u003Edeleteオプションには\u003Ccode\u003E--ignore-liveness\u003C\u002Fcode\u003Eという強力なフラグがあるのだけどこれを使っていたらnixの環境がgcされてnixでインストールしたものが一瞬全てなくなる羽目になってしまった。\nこれは結局 `\u002Fnix-profile\u002Fbin から辿れるシンボリックリンクを貼り直すことで回復できたけど、もうこのオプションは使いたくない。一体なぜパッケージを自分の環境から削除したのゴミにならないのか？\u003C\u002Fp\u003E\n\u003Cp\u003E調べてみたら（いや、適当に見当つけて見たら）、nixpkgsワーキングツリーのトップにnix-buildで生成されたstoreへのシンボリックリンク result というのが自動的にできるのだけど、これがGCのrootになっていた。\u003C\u002Fp\u003E\n\u003Cp\u003Eということで result をrmで消すと（そして nix-env -e すると）、 nix-store --delete で素直に消えてくれるようになりました。\u003C\u002Fp\u003E\n"},dir:{writable:true,enumerable:true,value:"article\u002F.json\u002F2020"},base:{writable:true,enumerable:true,value:"2020-04-05-nix-liveness.json"},ext:{writable:true,enumerable:true,value:".json"},sourceBase:{writable:true,enumerable:true,value:"2020-04-05-nix-liveness.md"},sourceExt:{writable:true,enumerable:true,value:".md"}})}],fetch:[],mutations:[]});