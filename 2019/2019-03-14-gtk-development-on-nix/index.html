<!doctype html><html style="has-navbar-fixed-top has-navbar-fixed-bottom" lang=ja><head><meta charset=utf-8><meta viewport="width=device-width, initial-scale=1"><link href="/favicon.ico?refresh=1" rel=icon type=image/x-icon><link href=https://shnarazk.github.io/atom.xml rel=alternate title=RSS type=application/atom+xml><link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css rel=stylesheet><link href=/style.css rel=stylesheet><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X rel=stylesheet><script crossorigin defer integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-LJ2FmexL77rmGm6SIpxq7y+XA6bkLzGZEgCywzKOZG/ws4va9fUVu2neMjvc3zdv src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/mathtex-script-type.min.js></script><script onload="renderMathInElement(document.body, {
				delimiters: [
					{left: '$$', right: '$$', display: true},
					{left: '$', right: '$', display: false},
					{left: '\\(', right: '\\)', display: false},
					{left: '\\[', right: '\\]', display: true}
				]
			});" crossorigin defer integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener('DOMContentLoaded',()=>{const a=Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'),0);if(a.length>0){a.forEach(b=>{b.addEventListener('click',()=>{const c=b.dataset.target;const d=document.getElementById(c);b.classList.toggle('is-active');d.classList.toggle('is-active')})})}})</script><title>Just a note</title><body><nav aria-label="main navigation" class="navbar is-fixed-top is-light" role=navigation><div class=navbar-brand><div class=navbar-item> <i class="fas fa-book-open has-text-info"></i> <a class=title href=/>GTK development on Nix on macOS</a></div><a aria-expanded=false aria-label=menu class=navbar-burger data-target=navigation-bar role=button> <span aria-hidden=true></span> <span aria-hidden=true></span> <span aria-hidden=true></span> </a></div><div class=navbar-menu id=navigation-bar><div class=navbar-end><div class="navbar-item has-dropdown" id=navigation-dropdown><a onclick="document.getElementById('navigation-dropdown').classList.toggle('is-active')" class=navbar-link></a><div class="navbar-dropdown is-right is-size-5"><a class=navbar-item href=/tags> <i class="fas fa-tags"></i> Tags </a><a class=navbar-item href=/about> <i class="fas fa-question-circle"></i> About </a><a class=navbar-item href=/atom.xml> <i class="fas fa-rss-square"></i>  RSS </a></div></div></div></div></nav><div style=padding-top:3rem><div class=article-container><h1 class="subtitle has-text-info has-text-weight-semibold">これでどこでもgtkでいいじゃん</h1><h2 id=C>C</h2><ul><li>sample target: https://developer.gnome.org/gtk3/stable/gtk-getting-started.html</ul><p>Dive into the environment:<pre class=language-sh data-lang=sh style=background:#fff;color:#323232><code class=language-sh data-lang=sh><span>nix-shell -p gtk3 gcc pkgconfig
</span></code></pre><p>And compile:<pre class=language-sh data-lang=sh style=background:#fff;color:#323232><code class=language-sh data-lang=sh><span>gcc `pkg-config --cflags gtk+-3.0` -o example example.c `pkg-config --libs gtk+-3.0`
</span></code></pre><p>That works.<h2 id=Rust_(updated_at_2020-07-05)>Rust (updated at 2020-07-05)</h2><p>If you need not to install your project as a nix package, just run:<pre class=language-sh data-lang=sh style=background:#fff;color:#323232><code class=language-sh data-lang=sh><span>$ nix-shell -p gtk3 pkgconfig
</span></code></pre><h2 id=Rust>Rust</h2><ul><li>package: https://crates.io/crates/gtk <ul><li>Cargo.toml: <code>gtk = 0.9</code><li>Cargo.toml: <code>gtk = 0.5</code> # 0.6 requires unstable channel as of 2019-03-14<li>Cargo.toml: <code>gtk = 0.6</code> # for stable channel as of 2019-07-02</ul><li>sample target: https://github.com/gtk-rs/gtk/blob/master/src/rt.rs</ul><p>Start with the same approach:<pre class=language-sh data-lang=sh style=background:#fff;color:#323232><code class=language-sh data-lang=sh><span>$ nix-shell -p gtk3 pkgconfig rustc cargo llvm
</span><span>$ cargo run
</span><span>    Finished dev </span><span style=font-weight:700;color:#a71d5d>[</span><span>unoptimized + debuginfo</span><span style=font-weight:700;color:#a71d5d>]</span><span> target(s) in 0.21s                                       
</span><span>     Running `target/debug/gtktest`
</span><span>thread </span><span style=color:#183691>'main'</span><span> panicked at </span><span style=color:#183691>'libgtk-3 was configured with `--enable-debug=no`. See https://github.com/gtk-rs/gtk/issues/270 for details'</span><span>, ~/.cargo/registry/src/github.com-1ecc6299db9ec823/gtk-0.5.0/src/rt.rs:137:13
</span><span>note: Run with `RUST_BACKTRACE</span><span style=font-weight:700;color:#a71d5d>=</span><span style=color:#183691>1</span><span>` for a backtrace.
</span></code></pre><ul><li>the issue: https://github.com/gtk-rs/gtk/issues/270<li>src: <a href=https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/libraries/gtk/3.x.nix>nix expression for gtk3</a></ul><p>So let's make an overlay:<pre style=background:#fff;color:#323232><code><span>self: super:
</span><span>{
</span><span>    gtk3RustDarwin = super.gtk3.overrideDerivation (attrs: { 
</span><span>        configureFlags = [
</span><span>            "--enable-debug"
</span><span>            "--disable-dependency-tracking"
</span><span>            "--disable-glibtest"
</span><span>            "--enable-quartz-backend"
</span><span>        ];
</span><span>    });
</span><span>}
</span></code></pre><p>What's <code>overrideDerivation</code>? It's a <a href=https://nixos.org/nixpkgs/manual/#sec-pkg-overrideDerivation>deprecated</a> function. So the following seems better:<pre style=background:#fff;color:#323232><code><span>self: super:
</span><span>{
</span><span>    gtk3RustDarwin = super.gtk3.overrideAttrs (attrs: rec {
</span><span>        configureFlags = [
</span><span>            "--enable-debug"
</span><span>            "--disable-dependency-tracking"
</span><span>            "--disable-glibtest"
</span><span>            "--enable-quartz-backend"
</span><span>        ];
</span><span>    });
</span><span>}
</span></code></pre><p>Anyway, give it a try.<pre class=language-sh data-lang=sh style=background:#fff;color:#323232><code class=language-sh data-lang=sh><span>$ nix-shell -p gtk3RustDarwin pkgconfig rustc cargo llvm
</span><span>$ cargo clean  </span><span style=font-style:italic;color:#969896># to purge the previous attempt
</span><span>$ cargo run
</span></code></pre><p>That works!<div class="date-footer is-size-7 is-family-code has-text-grey has-text-right" style=margin-top:2rem>Published at 2019-03-14   Last updated 2020-07-05 </div></div><nav class="navbar is-fixed-bottom" aria-label=navigation id=bottombar><div class=navbar-brand><div class=navbar-item><a class=tagword href=/tags/#gtk>#gtk</a></div><div class=navbar-item><a class=tagword href=/tags/#nixos>#NixOS</a></div><div class=navbar-item><a class=tagword href=/tags/#macos>#macOS</a></div></div></nav><footer class="copyright is-size-6 has-text-info">Copyright 2019-2023 Narazaki Shuji.</footer>