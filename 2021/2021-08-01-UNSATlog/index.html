<!doctype html><html style="has-navbar-fixed-top has-navbar-fixed-bottom" lang=ja><head><meta charset=utf-8><meta viewport="width=device-width, initial-scale=1"><link href="/favicon.ico?refresh=1" rel=icon type=image/x-icon><link href=https://shnarazk.github.io/atom.xml rel=alternate title=RSS type=application/atom+xml><link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css rel=stylesheet><link href=/style.css rel=stylesheet><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X rel=stylesheet><script crossorigin defer integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-LJ2FmexL77rmGm6SIpxq7y+XA6bkLzGZEgCywzKOZG/ws4va9fUVu2neMjvc3zdv src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/mathtex-script-type.min.js></script><script onload="renderMathInElement(document.body, {
				delimiters: [
					{left: '$$', right: '$$', display: true},
					{left: '$', right: '$', display: false},
					{left: '\\(', right: '\\)', display: false},
					{left: '\\[', right: '\\]', display: true}
				]
			});" crossorigin defer integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener('DOMContentLoaded',()=>{const a=Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'),0);if(a.length>0){a.forEach(b=>{b.addEventListener('click',()=>{const c=b.dataset.target;const d=document.getElementById(c);b.classList.toggle('is-active');d.classList.toggle('is-active')})})}})</script><title>Just a note</title><body><nav aria-label="main navigation" class="navbar is-fixed-top is-light" role=navigation><div class=navbar-brand><div class=navbar-item> <i class="fas fa-book-open has-text-info"></i> <a class=title href=/>UNSAT LOG, 2021, Aug.</a></div><a aria-expanded=false aria-label=menu class=navbar-burger data-target=navigation-bar role=button> <span aria-hidden=true></span> <span aria-hidden=true></span> <span aria-hidden=true></span> </a></div><div class=navbar-menu id=navigation-bar><div class=navbar-end><div class="navbar-item has-dropdown" id=navigation-dropdown><a onclick="document.getElementById('navigation-dropdown').classList.toggle('is-active')" class=navbar-link></a><div class="navbar-dropdown is-right is-size-5"><a class=navbar-item href=/tags> <i class="fas fa-tags"></i> Tags </a><a class=navbar-item href=/about> <i class="fas fa-question-circle"></i> About </a><a class=navbar-item href=/atom.xml> <i class="fas fa-rss-square"></i>  RSS </a></div></div></div></div></nav><div style=padding-top:3rem><div class=article-banner><img src=/2021/2021-08-01_banner.jpg></div><div class=article-banner-caption>TOKYO2020を見ながら</div><div class=article-container><h1 class="subtitle has-text-info has-text-weight-semibold">Vol.2, No.8.</h1><h1 id=Finally_Bugs_Fixed_in_July>Finally Bugs Fixed in July</h1><p>ようやくバグフィックス終わった。7月に<a href=https://github.com/shnarazk/splr/releases/tag/Splr-0.10.0>0.10.0リリース</a>できました。<h1 id=なんだったのか>なんだったのか</h1><p>Splrの開発史上最大最長の難問になった今回の不整合バグがどうやって発生したのか振り返っておきたい。現れたバグは様々だった。<ul><li>UNSAT certificateがおかしい — https://github.com/shnarazk/splr/issues/122<li>単位節が伝播を起こさない — https://github.com/shnarazk/splr/issues/119<li>割り当てられても伝播されない — https://github.com/shnarazk/splr/issues/117<li>依存グラフにより高いレベルのリテラルが出現する — https://github.com/shnarazk/splr/issues/116<li>除去リテラルを戻すとおかしい — https://github.com/shnarazk/splr/issues/115<li>依存グラフでbinary clauseでの方向が逆 — https://github.com/shnarazk/splr/issues/114</ul><p>とまあ呆れるくらい様々。 もうSATソルバーとしてはほぼ壊滅状態だった。<p>で、これらの原因は一つではなかった。 0.10.0のリリースまでに潰したのは以下の通り。<ul><li>chronoBTの最上レベルリテラル数が1の場合はchronoBTかそうでないかに関わらず同じ処理をしなければならなかったのだが、そうなっていなかった。論文の何気ない記述に引っ張られてしまった。<li>chronoBT混在環境においてcancel_untilの処理が不適切だった。割り当て順序の逆転が起きていて、正しい依存グラフが作れなくなってしまっていた。<li>単位伝播は問題ないのだが、Eliminatorやvivifierが生成する節がClauseDBに適切に登録されてなかったため、伝播に失敗する単位節が存在していた。またUNSAT certificateへの反映が不適切だった。<li>除去変数を戻すモデル拡張器があやしいようなそうでないようなわかりにくいコードだった（sliceやiteratorを使ったもっとRust的（モダン）で意味が取りやすいコードに修正した）。</ul><p>どれを取っても致命的なのだが、よくもまあもっと早い段階で気づけなかったものだろうか。 おおよそ1年近くSplrはバグ持ち、それもSATソルバーを名乗れないレベルのバグ持ちだったと言うことがわかり、赤面してしまう。<h1 id=After_0.10.0>After 0.10.0</h1><p>というわけで無事にSplr 0.10.0をリリースしてから、正しさを壊さないようにしながら、ちょっとづつパフォーマンスチューニング中です。<p>まずはLuby stabilizationが全然よくないので改善中。 気づいていたけども0.10.0にはどうやっても入れる時間的な余裕はなかったので後回しにしていた。 その後、どうもモードの変更を節削減と同期を取るのが相当に効くらしいということがわかったので、そちらを採用。 aes.cnfは0.10.0だと10000秒程度掛かるのが普通なんだけど、この部分を変えてみると2000秒台になっているし、sat-benchの結果もSplrのベストにかなり近くなった。 小さな変更なのだがリリースする価値がありそうだ。 初めて使ったalgorithm2eで書くとこうなる。 Reduction, Elimination, Vivification、そしてモードスイッチ、と綺麗な流れじゃないか。<p><img alt src=/2021/2021-08-01_LubyStabilization.png><p>ドキュメントを更新して数日中に0.10.1としてリリースの予定です。<p>あとは<ul><li>重複節の除去：どうもこれは重要のような気がするので早いところ統計データをとってみるつもり。in-processorを頻繁に起動するSplrでは無闇に重複節を発生させている可能性が捨てきれない。clause reductionの後にclause vivificationを実行するように順序を変更したことである程度は削減できているような気もするがさて？ 実際の戦略として組み込む価値があるかは未確定だけど、いくつのソルバーがこの機能のオプションを持っていたはずだし、<code>clause.lits</code>をhash値にマップすればそれほど計算量は高くならないのではないだろうか。</ul><p>という感じでまあぼちぼちと。 それよりは<ul><li>溜まりに溜まった論文読んで、<li>proceeding読んで、<li>benchmark suitを今年のものに入れ替えて、 とこれだけやれば8月は終わりです。</ul><div class="date-footer is-size-7 is-family-code has-text-grey has-text-right" style=margin-top:2rem>Published at 2021-08-01</div></div><nav class="navbar is-fixed-bottom" aria-label=navigation id=bottombar><div class=navbar-brand><div class=navbar-item><a class=tagword href=/tags/#sat>#SAT</a></div><div class=navbar-item><a class=tagword href=/tags/#splr>#splr</a></div><div class=navbar-item><a class=tagword href=/tags/#unsatlog>#unsatlog</a></div></div></nav><footer class="copyright is-size-6 has-text-info">Copyright 2019-2023 Narazaki Shuji.</footer>