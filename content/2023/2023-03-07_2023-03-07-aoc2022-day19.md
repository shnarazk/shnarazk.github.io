---
title: BQNã§AoC2022 day19ã‚’è§£ã“ã†
updated: 2023-03-10
extra:
  banner: /2023/2023-03-07_banner.jpg
  banner_caption: Mixamo â†’ Blender 
  subtitle: ï¼ˆã§ããŸã‚‰ï¼‰é…åˆ—æŒ‡å‘ã§çµŒè·¯æ¢ç´¢å•é¡Œã‚’
taxonomies:
  tags: ["bqn", "advent-of-code"]
---
[Advent of Code y2022 day19](https://adventofcode.com/2022/day/19)ã®[BQN](https://github.com/mlochbaum/BQN)è§£æ³•ã«å¤§å¤‰è‹¦åŠ´ã—ãŸï¼ˆã—ã¦ã„ã‚‹ï¼‰ã®ã§ã¡ã‚‡ã“ã£ã¨ãƒ¡ãƒ¢ã—ã¦ãŠã“ã†ã€‚

åŸºæœ¬çš„ã«ã¯æœ€çŸ­çµŒè·¯å•é¡Œãªã®ã§[Rustç‰ˆ](https://github.com/shnarazk/advent-of-code/blob/main/src/y2022/day19.rs)ã ã¨ã“ã‚“ãªæ„Ÿã˜ã€‚
```rust
let mut to_visit: BinaryHeap;
let mut visited: HashSet;

while let Some(state) = to_visit.pop() {
  for next in state.expand() {
    if !visited.contains(&next) {
      visited.insert(&next);
      to_visit.insert(&next);
    }
  }
}
```
ã“ã‚Œã‚’åŸºã«BQNç‰ˆã‚’ä½œã£ã¦ã„ã£ãŸã®ã ãŒã¨ã¦ã‚‚é…ãã¦è§£ã‘ã‚‹ã¨ã¯è¨€ãˆãªã‹ã£ãŸã®ã§ã•ã‚‰ã«çŸ¥æµã‚’çµã‚‹ã“ã¨ã«ãªã£ãŸã€‚
ã¡ãªã¿ã«[dzaimaç‰ˆ](https://github.com/dzaima/aoc/blob/master/2022/BQN/19.bqn)ã¯å®Ÿè¡Œã—ã¦ãªã„ã€‚

## 1. æ™‚é–“ã‚’å˜ä½ã¨ã™ã‚‹é·ç§»ã‹ã‚‰ãƒ­ãƒœãƒƒãƒˆè¿½åŠ ã‚’å˜ä½ã¨ã™ã‚‹é·ç§»ã¸
ã“ã‚Œã¯Rustç‰ˆã§ã‚‚å®Ÿè£…æ¸ˆã¿ã€‚çŠ¶æ…‹ç©ºé–“ã‚’ç¸®å°ã™ã‚‹ãŸã‚ã€ä½•ã‚‚ã—ãªã„ã§è³‡æºãŒå¢—ãˆã‚‹ã ã‘ã®æ¬¡ã‚¯ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ã®ã§ã¯ãªãã€ãƒ­ãƒœãƒƒãƒˆã®å¢—åŠ ã•ã›ãŸå¾Œã®çŠ¶æ…‹ã¸ã®é·ç§»ã§æ¬¡çŠ¶æ…‹ã‚’å®šç¾©ã—ã‚ˆã†ã€‚


## 2. å¿…è¦ä»¥ä¸Šã«ãƒ­ãƒœãƒƒãƒˆã‚’æºœã‚è¾¼ã‚€å¿…è¦ã¯ãªã„
clayãƒ­ãƒœãƒƒãƒˆã ã‘ã‚’ä½œã‚Šç¶šã‘ã‚‹é·ç§»ã¯æ„å‘³ãŒãªã„ã€‚ä»–ã®ãƒ­ãƒœãƒƒãƒˆã‚‚ä½œã‚‰ã­ã°ã€‚
ã¨ã„ã†ã“ã¨ã§å¿…è¦ä»¥ä¸Šã«ãƒ­ãƒœãƒƒãƒˆã‚’æºœã‚è¾¼ã‚€ã‚ˆã†ãªæ¬¡çŠ¶æ…‹ã¯æ¢ç´¢å¯¾è±¡ã«è¿½åŠ ã—ãªã„ã‚ˆã†ã«ã—ãŸã€‚
ã“ã‚Œã§çŠ¶æ…‹æ•°ãŒæœ‰é™ã«æŠ‘ãˆã‚‰ã‚Œã€æ™‚é–“è¨ˆç®—é‡ã‚‚ç©ºé–“è¨ˆç®—é‡ã‚‚å‰Šæ¸›ã§ãã‚‹ã€‚

## 3. Nå°ã®ãƒ­ãƒœãƒƒãƒˆã®çŠ¶æ…‹ã‹ã‚‰N+1å°ã®ãƒ­ãƒœãƒƒãƒˆã®çŠ¶æ…‹ã«é·ç§»ã—ãŸã‚ã¨ã§ã¯Nå°ã®ãƒ­ãƒœãƒƒãƒˆã®çŠ¶æ…‹ã‚’è¨˜æ†¶ã—ã¦ãŠãå¿…è¦ã¯ãªã„ã€‚
ãƒ­ãƒœãƒƒãƒˆæ•°ã®å¢—åŠ ãŒçŠ¶æ…‹é·ç§»ã‚’ã‚‚ãŸã‚‰ã™ãªã‚‰ã€ãƒ­ãƒœãƒƒãƒˆæ•°Nã®çŠ¶æ…‹ã‹ã‚‰ãªã‚‹é›†åˆã‚’ãã‚Œãã‚Œå±•é–‹ï¼ˆæ¢ç´¢ï¼‰ã—ã¦ã§ãã‚‹çŠ¶æ…‹é›†åˆã¯ï¼ˆå…¨ã¦ã®ï¼‰ãƒ­ãƒœãƒƒãƒˆæ•°N+1ã®çŠ¶æ…‹ãªã®ã§æ¢ç´¢æ¸ˆã¿ã‹ã©ã†ã‹ã¯ãã®é›†åˆå†…è¦ç´ ãŒé‡è¤‡ã—ã¦ã„ãªã„ã“ã¨ã®åˆ¤å®šã«å¸°ç€ã™ã‚‹ã€‚
Næœªæº€ã®ãƒ­ãƒœãƒƒãƒˆæ•°ã®çŠ¶æ…‹ã‚’è¨˜æ†¶ã—ã¦ãŠãå¿…è¦ã¯ãªã„ã€‚Life gameã®ã‚ˆã†ã«2ã¤ã®bagã‚’åˆ‡ã‚Šæ›¿ãˆãªãŒã‚‰å±•é–‹ã—ã¦ã„ã‘ã°ã‚ˆã„ã€‚

## 4. çŠ¶æ…‹ã®æåˆˆ
ã•ã‚‰ã«çŠ¶æ…‹ãŒå®Œå…¨ã«é †åºä»˜ã‘å¯èƒ½ãªã‚‰æåˆˆãŒã§ãã‚‹ã€‚ã¤ã¾ã‚Š
- æ™‚åˆ»ãŒæ—©ã„
- è³‡æºï¼ˆé‰±çŸ³é‡ï¼‰ãŒå¤šã„
- ãƒ­ãƒœãƒƒãƒˆãŒå¤šã„

ãªã‚‰ã°ã€å°ã•ãªæ–¹ã®çŠ¶æ…‹ã‚’å±•é–‹å¯¾è±¡ã«è¿½åŠ ã™ã‚‹å¿…è¦ã¯ãªã„ã€‚

Rustç‰ˆã§ã¯å®Œå…¨ä¸€è‡´ã ã‘ã—ã‹è¦‹ã¦ã„ãªã‹ã£ãŸã®ã§ã‚ˆã‚Šè‰¯ã„æåˆˆãŒã§ãã‚‹ã€‚å¤šåˆ†$O(N)$ã®ç·å½“ãŸã‚Šãªå®Ÿè£…ã§ã‚‚è¦‹åˆã†ã¯ãšã€‚

## 5. æ·±ã•1ã®ãƒªã‚¹ãƒˆåŒ–
æ€§èƒ½ã«å¯„ä¸ã™ã‚‹ã®ã‹ã—ãªã„ã®ã‹ã‚ã‹ã‚‰ãªã„ã®ã ãŒã€çŠ¶æ…‹ã®è¡¨ç¾ã‚’ãƒã‚¹ãƒˆã‚’ã‚„ã‚ã¦ãƒ•ãƒ©ãƒƒãƒˆãªãƒ™ã‚¯ã‚¿ãƒ¼ã«ã—ã¦ã¿ãŸã€‚

```apl
timeâ€¿âŸ¨noreâ€¿nclayâ€¿nobsidianâ€¿ngeodeâŸ©â€¿âŸ¨roreâ€¿rclayâ€¿robsidianâ€¿rgeodeâŸ©
```
ãŒã“ã†ãªã£ãŸã€‚
```apl
timeâ€¿noreâ€¿nclayâ€¿nobsidianâ€¿ngeodeâ€¿roreâ€¿rclayâ€¿robsidianâ€¿rgeode
```

## 6. æ™‚é–“æ–¹å‘ã‚’é€†è»¢ã™ã‚‹ã“ã¨ã«ã‚ˆã‚‹çŠ¶æ…‹ã®åŠé †åºé–¢ä¿‚å®šç¾©ã®ç°¡ç•¥åŒ–

çŠ¶æ…‹ã®é †åºé–¢ä¿‚ã®å®šç¾©ã¯æ™‚åˆ»ã ã‘ãŒä¸ç­‰å·ã®å‘ããŒé€†ã§æ®‹å¿µãªã“ã¨ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€çµ±ä¸€ã—ã‚ˆã†ã€‚
ãã®ãŸã‚ã€æ™‚åˆ»ã¯0ã‹ã‚‰å§‹ã¾ã‚Š`Â¯âˆ`ã«å‘ã‹ã£ã¦é€²ã‚€ã“ã¨ã«ã™ã‚‹ã¨æ™‚åˆ»ãŒæ—©ã„ã¨ã¯å€¤ãŒå¤§ãã„ã“ã¨ã‚’æ„å‘³ã™ã‚‹ã®ã§ã€
```apl
{(ğ•¨(>â—‹âŠ‘)ğ•©)âˆ§(ğ•¨((âˆ§Â´<)â—‹(1â†“))ğ•©)}
```

ã¯ã“ã†ãªã‚‹ï¼š

```apl
(âˆ§Â´<)
```

golf!

## 7-X. æ—¢ã«çŠ¶æ…‹é›†åˆã«ç™»éŒ²ã•ã‚ŒãŸçŠ¶æ…‹ã®æåˆˆ

æ–°ã—ã„çŠ¶æ…‹ã‚’ç™»éŒ²ã™ã‚‹ã‹ã©ã†ã‹ã‚’æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹æ¬¡çŠ¶æ…‹ã¨ã®é †åºé–¢ä¿‚ã«åŸºã¥ãåˆ¤å®šã™ã‚‹ã“ã¨ãŒæœ‰åŠ¹ãªã‚‰ã€
é€†ã«ç™»éŒ²æ¸ˆã¿ã®çŠ¶æ…‹ã®å‰Šé™¤ã‚‚æœ‰åŠ¹ãªã¯ãšãªã‚“ã ãŒé€Ÿåº¦ãŒ2å€ã»ã©ä½ä¸‹ã—ã¦ã—ã¾ã£ãŸã€‚
è¨ˆç®—ã‚³ã‚¹ãƒˆã®å•é¡Œã ã‚ã†ã‹ã€‚

## 7. çŠ¶æ…‹é›†åˆã®æ•´åˆ—

ä¸€æ–¹ã€Nãƒ­ãƒœãƒƒãƒˆã®çŠ¶æ…‹ã‹ã‚‰ã®é·ç§»å…ˆã‚’å…¨ã¦æ±‚ã‚ãŸå¾Œã§ã€N+1çŠ¶æ…‹ã®å±•é–‹ã‚’å§‹ã‚ã‚‹å‰ã«çŠ¶æ…‹é›†åˆã‚’ã‚½ãƒ¼ãƒˆã—ã¦ã‚„ã‚‹ã¨ãªãœã‹å®Ÿè¡Œæ™‚é–“ãŒåŠåˆ†ã»ã©ã«ãªã£ãŸã€‚
ã‚½ãƒ¼ãƒˆã¯æ˜‡é †ã§ãªã‘ã‚Œã°ãªã‚‰ãšã€é™é †ã ã¨1æ™‚é–“çµŒã£ã¦ã‚‚çµ‚ã‚ã‚‰ãªã‹ã£ãŸã€‚
ãŸã ã—`Â´`ã§foldã—ã¦ã„ã‚‹ã®ã§å®Ÿéš›ã«ã¯é™é †ã€ã¤ã¾ã‚Šçµ‚äº†æ™‚åˆ»ã«è¿‘ã„æ–¹ã‹ã‚‰å±•é–‹ã—ã¦ã„ã‚‹ã®ã§ã€
æ·±ã•å„ªå…ˆæ¢ç´¢ã«ãªã£ãŸã‚ˆã†ã ã€‚

[ã“ã“](https://github.com/shnarazk/advent-of-code/blob/main/bqn/2022/day19.bqn)ã¾ã§ã§è„³ã¿ãåˆ‡ã‚Œã€‚é ‘å¼µã£ãŸã®ã ãŒpart2ã¯10åˆ†æ›ã‹ã‚‹ã€‚

## è¿½è¨˜

syntax highlighterã®ã©ã‚Œã‹ãŒBQNã«å¯¾å¿œã—ãŸã¨ã„ã†è©±ã‚’è¦‹ãŸã®ã§ã¡ã‚‡ã£ã¨è²¼ã‚Šä»˜ã‘ã¦ã¿ã‚ˆã†ã€‚

ã“ã¡ã‚‰ã¯`apl`:

```apl
lib â† â€¢Import "../lib.bqn"
Solve â‡ { part ğ•Š line:
  data â† >{
    4â€¿4â¥ŠâŸ¨
          1âŠ‘ğ•©,   0,   0,  0,
          2âŠ‘ğ•©,   0,   0,  0,
          3âŠ‘ğ•©, 4âŠ‘ğ•©,   0,  0,
          5âŠ‘ğ•©,   0, 6âŠ‘ğ•©,  0,
        âŸ©
  }âˆ˜lib.ParseIntsÂ¨ line
  Examine â† { u ğ•Š n:
    bestâ€¿bpâ€¿upto â† âŸ¨0,nâŠdata,-uâŸ©
    masksâ€¿limits â† âŸ¨0<Ë˜bp,0â€¿0â€¿0â€¿âˆâŒˆâŒˆÂ´Ë˜â‰bpâŸ©
    Expand â† {
      ğ•Š âŸ¨âŸ©: best;
      ğ•Š cands:
        ğ•Š âˆ§ âŸ¨âŸ© { timeâ€¿resourcesâ€¿robots ğ•Š next:
          { ğ•Š i:
            upto< t â† time- w â† 1+âŒˆâŒˆÂ´(iâŠmasks)/robotsÃ·Ëœ(n â† iâŠbp)(0âŠ¸âŒˆ-)resources ?
              { Â¬âˆ¨Â´(âˆ§Â´ğ•©âŠ¸â‰¤)Â¨next ? next âŸ¨ğ•©âŸ©âŠ¸âˆ¾ â†©, best ((4âŠ‘ğ•©)+(t-upto)Ã—Â¯1âŠ‘ğ•©)âŠ¸âŒˆ â†© ;@
              } tâˆ¾(n-Ëœresources+wÃ—robots)âˆ¾((1âŠ¸+)âŒ¾(iâŠ¸âŠ‘)robots)
            ;@
          }Â¨{robots<â—‹(ğ•©âŠ¸âŠ‘)limits }Â¨âŠ¸/â†•4
          next
        }Â´{âŸ¨âŠ‘ğ•©,4â†‘1â†“ğ•©,5â†“ğ•©âŸ©}Â¨cands
    }
    (â€¢Fmt n) lib.Debug Expand âŸ¨âŸ¨0âŸ©âˆ¾âŸ¨0,0,0,0âŸ©âˆ¾âŸ¨1,0,0,0âŸ©âŸ© # âŸ¨time,resources,robotsâŸ©
  }
  {
    1=part ? +Â´ 24 ((1âŠ¸+)Ã—Examine)Â¨â†•â‰ data
    ; 2=part ? Ã—Â´ 32 ExamineÂ¨â†•3
    ; "â‰¢data" lib.Debug â‰¢data
  }
}
```

ã“ã¡ã‚‰ã¯`bqn`:

```bqn
lib â† â€¢Import "../lib.bqn"
Solve â‡ { part ğ•Š line:
  data â† >{
    4â€¿4â¥ŠâŸ¨
          1âŠ‘ğ•©,   0,   0,  0,
          2âŠ‘ğ•©,   0,   0,  0,
          3âŠ‘ğ•©, 4âŠ‘ğ•©,   0,  0,
          5âŠ‘ğ•©,   0, 6âŠ‘ğ•©,  0,
        âŸ©
  }âˆ˜lib.ParseIntsÂ¨ line
  Examine â† { u ğ•Š n:
    bestâ€¿bpâ€¿upto â† âŸ¨0,nâŠdata,-uâŸ©
    masksâ€¿limits â† âŸ¨0<Ë˜bp,0â€¿0â€¿0â€¿âˆâŒˆâŒˆÂ´Ë˜â‰bpâŸ©
    Expand â† {
      ğ•Š âŸ¨âŸ©: best;
      ğ•Š cands:
        ğ•Š âˆ§ âŸ¨âŸ© { timeâ€¿resourcesâ€¿robots ğ•Š next:
          { ğ•Š i:
            upto< t â† time- w â† 1+âŒˆâŒˆÂ´(iâŠmasks)/robotsÃ·Ëœ(n â† iâŠbp)(0âŠ¸âŒˆ-)resources ?
              { Â¬âˆ¨Â´(âˆ§Â´ğ•©âŠ¸â‰¤)Â¨next ? next âŸ¨ğ•©âŸ©âŠ¸âˆ¾ â†©, best ((4âŠ‘ğ•©)+(t-upto)Ã—Â¯1âŠ‘ğ•©)âŠ¸âŒˆ â†© ;@
              } tâˆ¾(n-Ëœresources+wÃ—robots)âˆ¾((1âŠ¸+)âŒ¾(iâŠ¸âŠ‘)robots)
            ;@
          }Â¨{robots<â—‹(ğ•©âŠ¸âŠ‘)limits }Â¨âŠ¸/â†•4
          next
        }Â´{âŸ¨âŠ‘ğ•©,4â†‘1â†“ğ•©,5â†“ğ•©âŸ©}Â¨cands
    }
    (â€¢Fmt n) lib.Debug Expand âŸ¨âŸ¨0âŸ©âˆ¾âŸ¨0,0,0,0âŸ©âˆ¾âŸ¨1,0,0,0âŸ©âŸ© # âŸ¨time,resources,robotsâŸ©
  }
  {
    1=part ? +Â´ 24 ((1âŠ¸+)Ã—Examine)Â¨â†•â‰ data
    ; 2=part ? Ã—Â´ 32 ExamineÂ¨â†•3
    ; "â‰¢data" lib.Debug â‰¢data
  }
}
```

