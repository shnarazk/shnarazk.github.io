---
title: How to run 'nix-build' on flake-based nix system
extra:
  subtitle: if we have `shell.nix` or `default.nix`
taxonomies:
  tags: ["nix"]
---
`-I`オプションを知っていればnix-build用に書かれたxxxxx.nixを使うことができますな。

```
$ nix build -I nixpkgs=https://github.com/NixOS/nixpkgs/archive/master.tar.gz --impure --file  xxxxxx.nix -o  
```

`-I`から`<nixpkgs>` が設定される（参考：  https://nixos.org/#asciinema-demo-example_4 )。

ここでxxxx.nixは以下のような実行ファイル（derivationファイルではない）。

```nix
with import <nixpkgs> { };

pkgs.dockerTools.buildLayeredImage {
	name = "nix-hellow";
	tag = "latest";
	contents = [ pkgs.hello ]; 
}
```
