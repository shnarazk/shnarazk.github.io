---
title: Nix 2.4 released
extra:
  banner: /2021/2021-11-02_banner.jpg
  subtitle: experimental-features = nix-command flakes
taxonomies:
    tags: ["NixOS"]
---

- [Announcement on Nix discourse](https://discourse.nixos.org/t/nix-2-4-released/15822/5)
- [Manual (for version 2.4)](https://nixos.org/manual/nix/stable/)

私の知る限りではこれで普段

```
nix profile upgrade
```

とだけすればよくて、気が向いたら

```
nix profile wipe-history --older-than 7d
```

で古いプロファイルの回収ということらしい。flakeはTTLが切れたら勝手に更新してくれる。

ただし、こうしたいならchannelからではなくflakeからパッケージをインストールしなければならない。
以下はnixpkgs-unstable channelからnixpkgs/nixpkgs-unstable registryへ引越しの途中の状態。

```
0 - - /nix/store/l1nnjj26j4nfggzfdp25d5074m35xrwa-parallel-20210722
4 - - /nix/store/6kaig6yyxm6mfha5b21x827dkfazb0cg-ispell-3.4.04
7 - - /nix/store/ghshklfk3q98cikad1wf8b0rpwhmp1iz-tmux-3.2a
8 - - /nix/store/475pa4h5rd6289zm8iga507ppl3k9zwn-nix-2.4pre-rc1
5 - - /nix/store/wiqcjg66s7sb6cais8pifrk3l9cpkrmq-nss-cacert-3.66
7 flake:nixpkgs/nixpkgs-unstable#legacyPackages.x86_64-darwin.tmux github:NixOS/nixpkgs/7053541084bf5ce2921ef307e5585d39d7ba8b3f#legacyPackages.x86_64-darwin.tmux /nix/store/ghshklfk3q98cikad1wf8b0rpwhmp1iz-tmux-3.2a
11 flake:nixpkgs/nixpkgs-unstable#legacyPackages.x86_64-darwin.ispell github:NixOS/nixpkgs/7053541084bf5ce2921ef307e5585d39d7ba8b3f#legacyPackages.x86_64-darwin.ispell /nix/store/6kaig6yyxm6mfha5b21x827dkfazb0cg-ispell-3.4.04
14 flake:nixpkgs/nixpkgs-unstable#legacyPackages.x86_64-darwin.parallel github:NixOS/nixpkgs/7053541084bf5ce2921ef307e5585d39d7ba8b3f#legacyPackages.x86_64-darwin.parallel /nix/store/l1nnjj26j4nfggzfdp25d5074m35xrwa-parallel-20210722
```

検索したいなら：

```
nix search nixpkgs package-name
```

flakeはキャッシュされるので`nix-env -qa`とは比べ物にならない。


なんか成熟感と新鮮さが同時にやってきた。
