---
title: JUSTANOTE Version 1.0.2
subtitle: import from GitHub Gist
date: 2020-08-14
tags: ["justanote"]
---
このブログの静的サイトジェネレータ（名前はまだないとりあえず"JUSTANOTE"にしておきます）をバージョン1.0.2に更新しました。変更点はgithub.comに作ったgistが取り込めるようになったこと。


[Observable](https://observablehq.com/)が（結構）簡単に取り込めたので、1時間程度でできるかと思ったら数日掛かってしまいました。

* githubが埋め込み用に提供するのはjavascriptまたはjson。ちょっとjavascriptは置いといてjsonを使う方向で計画。
* ところがjsonを読み込もうとすると `Cross-Access-Allow-Origin` の制約に引っかかってデータがとって来れない。手動でリロードを掛けて、サーバー側のレンダリングされたページを持ってくれば表示はできるけどかっこ悪い。
* asyncDataなのかfetchなのか、どこに書けばベストなのか、他（下）の問題も解決しながら、調べて実験して、結局 `nuxtServerInit`　をストアに追加。（追加するのも一苦労。actionsの中に書くのね。）

```js
export const actions = {
  async nuxtServerInit({ commit }) {
```

* さらに `forEach` で呼び出す関数が `async` にできないことを理解するのに一苦労（まあ、`nuxtServerInit`の先頭に`async`を置きながら、forEachの無名関数にもおかなくていいのか **うっすらと** 疑問は感じてた）。
これでレンダリングが始まる前に全てのエントリーのデータを持って来れるようになったのでfetchの問題解決。

* 平行して、取ってきたjsonの中のhtmlセグメント中の `iframe` の大きさの取り扱いにも一苦労。
jupyter notebookを貼り付けたgistだけは`height: auto`が効かない（コンテンツの高さがデフォルトの150pxに固定されてしまう）。しょうがないので、設定ファイル中でipynbかどうかを指定するフラグを用意して、そのフラグが立っていたら、`height: 2000px;`にしてしまうクラスを使うようにしました。

```js
      <div :id="$route.params.slug" class="githubgist-content" :class="{ 'githubgist-frame': article.frame }">
        <span v-html="article.content"></span>
      </div>

```

* 後は`axios.get` ではデータそのものではなくレスポンスが帰ってくるので

```js
const json = axios.get(url).then((res) => { return res.data })
```

でなければいけない問題。これもちょっとはまりました。一個一個の問題は大したことないのだけど、切り分けができない多数の問題が降ってきたので、あああ、疲れた。

さて、なんでgithubの返す埋め込み用javascriptをそのまま使うのをやめたんだっけ？ 最初に何も考えずにObservableのコードを流用したら動かなかったのは確かなんだけど。。。
